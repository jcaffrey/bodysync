function submitOnEnterKey(a,b){b=b||form;for(var c=function(b){13===b.keyCode&&a()},d=b.childNodes,e=0;e<d.length;e++){var f=d[e];f.id&&"js-admin-info"===f.id&&submitOnEnterKey(a,f);var g=f.getAttribute("type");"text"!==g&&"email"!==g&&"password"!==g&&"number"!==g&&"phone"!==g||(f.onkeydown=c)}}function submitLogin(){var a={email:form.email.value,password:form.password.value};localStorage.email=a.email,fetch("/login",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)}).then(function(a){return a.ok?a.json().then(function(a){localStorage.token=a.token,localStorage.id=JSON.parse(atob(a.token.split(".")[1])).id,window.location="/patients"}):submitError(a)}).catch(submitError)}function submitPatientLogin(){var a={email:form.email.value,password:form.password.value};localStorage.email=a.email,fetch("/loginPatient",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)}).then(function(a){return a.ok?a.json().then(function(a){localStorage.token=a.token,localStorage.id=JSON.parse(atob(a.token.split(".")[1])).id,getPatientView()}):submitError(a)}).catch(submitError)}function logout(){localStorage.id="",localStorage.token="",localStorage.patients="",localStorage.display="",localStorage.focusPatient="",localStorage.ctr1="",localStorage.ctr2="",localStorage.isPatient="";for(var a in localStorage)a.includes("graphData")&&(localStorage[a]="");window.location="/"}function tokenVerification(){function a(){setTimeout(function(){JSON.parse(atob(localStorage.token.split(".")[1])).exp<+new Date/1e3?expiredToken():a()},1e4)}a()}function expiredToken(){document.getElementById("token-modal").style.display="block",document.getElementById("error-label").innerHTML="",document.getElementById("content").style.display="none",hashTimeout=setTimeout(function(){logout()},3e4)}function submitToken(){var a={email:localStorage.email,password:tokenForm[0].value},b="true"==localStorage.isPatient?"/loginPatient":"/login";fetch(b,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)}).then(function(a){if(!a.ok)return submitError(a);a.json().then(function(a){console.log("success"),clearTimeout(hashTimeout),localStorage.token=a.token,localStorage.id=JSON.parse(atob(a.token.split(".")[1])).id,document.getElementById("token-modal").style.display="none",document.getElementById("error-label").innerHTML="",document.getElementById("content").style.display="block",tokenForm[0].value="",tokenVerification()})}).catch(function(){document.getElementById("error-label").innerHTML="<p>Invalid password</p>"})}function headers(){return{"x-access-token":localStorage.token,"Content-Type":"application/json"}}function submitForm(){var a={},b="";form.fullName.value&&(a.name=form.fullName.value),form.password.value==form.confirmPassword.value&&(a.hash=form.password.value),form.email.value&&!validateEmail(form.email)&&(b+="Email address is invalid."),a.email=form.email.value,fetch("/pts",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)}).then(submitSuccess).catch(submitError)}function postMetric(a,b,c,d){var e={startRange:b,endRangeGoal:c,name:"name"+a};fetch("/injuries/"+a+"/romMetrics",{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)}).then(function(e){e.ok||console.log(e),postMeasure(a,b,c,d)}).catch(function(a){console.log(a)})}function postMeasure(a,b,c,d){var e=new Date,f=new Date;f.setDate(f.getDate()+7);var g={dayMeasured:e.toMysqlFormat(),dayOfNextGoal:f.toMysqlFormat(),nextGoal:c,degreeValue:b,name:"measure"+a,endRangeGoal:d};fetch("/romMetrics/"+a+"/romMetricMeasures",{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(g)}).then(function(a){a.ok||console.log(a)}).catch(function(a){console.log(a)})}function submitPatient(){form.style.display="none",document.getElementById("loading").innerHTML='<p>Loading</p><img src="../../img/loading.gif">';var a={},b="";form.name.value&&(a.name=form.name.value),form.email.value&&!validateEmail(form.email)&&(b+="Email address is invalid."),a.email=form.email.value,form.phone.value&&(a.phoneNumber=form.phone.value),form.hash.value&&(a.hash=form.hash.value),form.surgery.value&&(a.surgeryType=form.surgery.value),form.notes.value&&(a.ptNotes=form.notes.value),form.isRestrictedFromRom.value&&(a.isRestrictedFromRom=form.isRestrictedFromRom.value),form.age.value&&(a.age=form.age.value),form.weight.value&&(a.weight=form.weight.value),form.name.value&&form.email.value&&hash.name.value&&form.phone.value&&form.isRestrictedFromRom.value&&fetch("/pts/"+localStorage.id+"/patients",{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)}).then(function(a){return a.ok?a.json().then(function(a){for(var b=document.getElementsByClassName("rom-name-input"),c=document.getElementsByClassName("degrees"),d=0;d<b.length;d++)!function(d){fetch("/patients/"+a.id+"/injuries",{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:b[d].value,injuryFromSurgery:"true"})}).then(function(a){return a.ok?a.json().then(function(a){postMetric(a.id,c[2*d].value,c[2*d+1].value,c[2*d+1].value)}):submitError(a)}).catch(submitError)}(d);setTimeout(function(){window.location="/patients"},1e3)}):submitError(a)}).catch(submitError)}function submitExerciseSet(){form.style.display="none";for(var a=JSON.parse(localStorage.focusPatient),b=document.getElementsByClassName("exercise-name-input"),c=document.getElementsByClassName("degrees"),d=document.getElementsByClassName("degrees2"),e=document.getElementsByClassName("notes"),f=0;f<b.length;f++)if(""==b[f].value||""==c[f].value||""==d[f].value)return void(document.getElementById("exSetModal").style.display="block");for(var g=0;g<b.length;g++)""!==b[g].value&&""!==c[g].value&&""!==d[g].value&&function(f){fetch("patients/"+a.id+"/createSingleExercise?token="+localStorage.token,{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:b[f].value,numSets:c[f].value,numRepsOrDuration:d[f].value,ptNotes:e[f].value})}).then(function(a){if(!a.ok)return submitError(a);f==b.length-1&&(window.location="/patients")}).catch(submitError)}(g)}function submitEditExercise(){form.style.display="none",document.getElementById("loading").innerHTML='<p>Loading</p><img src="../../img/loading.gif">';var a={};form[0].value&&(a.name=form[0].value),form[1].value&&(a.numSets=form[1].value),form[2].value&&(a.numRepsOrDuration=form[2].value),form[3].value&&(a.ptNotes=form[3].value),fetch("exercises/"+JSON.parse(localStorage.focusExercise).id+"/?token="+localStorage.token,{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(a)}).then(function(a){if(!a.ok)return submitError(a);window.location="/patients"}).catch(submitError)}function error(a){a.style.border="3px solid #f00"}function clearError(a){if("message"===a)return document.getElementById("js-error-message").style.visibility="hidden";a.style.border="1px solid #888"}function validatePhone(a,b){var c=a.value;if(!c&&!b)return"";for(var d="",e=0;e<c.length;e++)isNaN(c[e])||" "===c[e]||(d+=c[e]);return 10!==d.length?(error(a),""):d}function validateEmail(a,b){var c=a.value;if(!c&&!b)return!0;var d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(c);return d||error(a),d}function validateProvider(a){return"other"===form.phoneProvider.value?"none"===form["other-provider"].style.display?(form["other-provider"].style.display="inline-block",!1):!!form["other-provider"].value||(error(form["other-provider"]),!1):(form["other-provider"].style.display="none","null"!==form.phoneProvider.value||!a||(error(form.phoneProvider),!1))}function validateUrl(a,b){if(!a.value&&!b)return!0;var c=/^.+\.[a-zA-Z]{2,}/.test(a.value);return c||error(a),c}function clearForm(){form.reset(),clearError("message");for(var a=document.getElementsByClassName("hidden"),b=0;b<a.length;b++)a[b].style.display=""}function submitSuccess(a){if(!a.ok)return submitError(a);window.location="/patients"}function submitError(a,b){return a.status>=400&&a.status<500?a.text().then(function(a){displayError(a)}):displayError(b?b:"There was a problem submitting your form. Please try again later.")}function displayError(a){var b=document.getElementById("js-error-message");b.innerHTML=a,b.style.visibility="visible"}function getPatientView(){fetch("/patients/"+localStorage.id+"/?token="+localStorage.token).then(function(a){if(!a.ok)throw a;a.json().then(function(a){localStorage.isPatient=JSON.stringify(!0),localStorage.patients=JSON.stringify([a]),window.location="/patient-home"})}).catch(submitError)}function displayCollapse(a){var b=document.getElementById(a);"none"===b.style.display?b.style.display="block":b.style.display="none"}function toggleOpen(a){document.getElementById(a).classList.toggle("open")}function color(a){return isNaN(a)?["bbbbbb","../../img/flatIcon.png","flatIcon"]:a<33.3?["ce2310","../../img/downIcon.png","downIcon"]:a<66.7?["fab03c","../../img/flatIcon.png","flatIcon"]:["1a924c","../../img/upIcon.png","upIcon"]}function loadPatients(a){setTimeout(function(){var b=JSON.parse(a),d=JSON.parse(localStorage.isPatient);if(0!==b[0].progress.length)for(var e=b[0].isRestrictedFromRom,f=0;f<b.length;f++){if(!d||!e){for(var g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("img"),j=document.createElement("img"),k=document.createElement("div"),l=document.createElement("div"),m=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),p=document.createElement("div"),q=document.createElement("div"),r=0,s=0,t=0;t<b[f].progress.length;t++){var u=b[f].progress[t];null!=u&&(r+=+u[0],s++)}var v=(r/s).toFixed(1),w=color(v);switch(b[f].name){case"Josh Seides":case"David Malan":case"Zamyla Chan":case"Sam Pelletier":i.src="../../img/"+b[f].name+".jpg";break;default:i.src="../../img/Josh Seides.jpg"}i.setAttribute("id","profileImg"),j.src=w[1],j.setAttribute("id",w[2]),m.setAttribute("class","recovery-box"),n.setAttribute("class","percent1"),"bbbbbb"===w[0]?n.innerHTML="<span>N/A</span>":n.innerHTML="<span>"+v+"%</span>",n.style.color="#"+w[0],o.setAttribute("class","arrow"),o.setAttribute("class","nav-icon"),o.setAttribute("id","nav-icon"+f),o.innerHTML="<span></span><span></span><span></span><span></span>",q.setAttribute("class","buttonCollapse");var x=d?"":'" style="display:none">',y='<div class="collapse" id= "collapse'+f+x+'<hr><div class="space"></div>';d&&(y+='<hr><div class="space"></div>');for(var z=0;z<b[f].progress.length;z++){var A=b[f].progress[z];null!==A&&(c="#"+color(A[0])[0],y+='<div class="collapse-inner"><div class="input-label">'+A[1]+'</div><div class="input-percent" style="color:'+c+'">',"#bbbbbb"===c?y+="N/A</div>":y+=A[0]+"%</div>",y+="</div>")}y+=d?'<div class="space"></div><a href="/patient-status-patient" class="inspect1" id= "inspect-btn'+f+'" onclick="focusPatient('+b[f].id+')">View Progress</a>':'<div class="space"></div><a href="/patient-status" class="inspect1" id= "inspect-btn'+f+'" onclick="focusPatient('+b[f].id+')">View Progress</a>',q.innerHTML=y,p.setAttribute("class","recovery"),"bbbbbb"!==w[0]&&(p.innerHTML="<span>Recovered</span>")}if(document.getElementById("loading").style.display="none",d&&e){var g=document.createElement("div");g.innerHTML='<p class="headerGrey" style="margin-bottom: 1%"></p>',document.getElementById("patients").appendChild(g)}else m.appendChild(n),m.appendChild(p),g.setAttribute("class","pt-box"),g.setAttribute("onclick","displayCollapse('collapse"+f+"'); toggleOpen('nav-icon"+f+"')"),h.setAttribute("class","pic-box"),k.setAttribute("class","info-box"),l.setAttribute("class","name"),h.appendChild(i),h.appendChild(j),l.appendChild(document.createTextNode(b[f].name)),k.appendChild(l),k.appendChild(m),g.appendChild(h),g.appendChild(k),d||g.appendChild(o),g.appendChild(q),document.getElementById("patients").appendChild(g)}else loadPatients(localStorage.patients)},1e3)}function loadEmpty(){clear(),document.getElementById("loading").style.display="none";var a=document.createElement("div");a.innerHTML="true"==localStorage.isPatient?'<p class="empty-error">No data to display.</p>':'<p class="empty-error">No patients to display.</p>',document.getElementById("patients").appendChild(a)}function change(a){a.style.display="none"}function change1(a){a.style.display="inline-block"}function change2(a){a.style.background="#2e3192"}function change3(a){a.style.background="#bbb"}function change4(a){a.style.opacity="1"}function change5(a){a.style.opacity="0.5"}function change6(e){for(var pfp=JSON.parse(localStorage.focusPatient),count=0,j=1;j<pfp.progress.length;j++){var val=pfp.progress[j];if(null!==val){var ele=eval("(iconGraph"+(count+1)+")");ele!=e&&(change(ele),count++)}}}function chooseInjury(a){return JSON.parse(localStorage.focusPatient).progress[a][0]}function loadFocusPatient(){getGraphData();for(var a=JSON.parse(localStorage.focusPatient),b=JSON.parse(localStorage.isPatient),d=0,e=0,f=0;f<a.progress.length;f++){var g=a.progress[f];null!=g&&(d+=+g[0],e++)}var h,i=(d/e).toFixed(1),j=color(i),k=document.createElement("div");switch(a.name){case"Josh Seides":case"David Malan":case"Zamyla Chan":case"Sam Pelletier":h=a.name;break;default:h="Josh Seides"}var l='<div class="pt-box"><div class="pic-box"><img id="profileImg" src="../../img/'+h+'.jpg"></img><img id="upIcon" src=" '+j[1]+'"></img></div>';l+='<div class="info-box"><div class="name">'+a.name+'</div><div class="recovery-box"><div class="percent1">'+colorPercent(i,j[0])+'</div><div class="recovery"><span>RECOVERED</span></div></div></div></div>',k.innerHTML=l;var m=document.createElement("div");m.setAttribute("class","menu-box"),m.setAttribute("id","menuBox"),m.style.display="inline-block",m.style.display="none";var n='<div class="menu-top"><div class="exit-sign"><button style="padding:0" id="exitButton" onclick="change(menuBox); change4(bottomBox)">X</button></div></div>';n+='<div class="menu-options"><div class="option option0"><div class="menu-icon" id="iconOverview" style="display:none";></div><span onclick="change(iconOverview); change(bodyBox); change(menuBox); change1(overviewBox); change1(bottomBox); change4(bottomBox); change6(iconOverview); change2(iconOverviewTrans);change(menuBox); change4(bottomBox)">Overview</span></div>';for(var o="",e=0,p=0;p<a.progress.length;p++){var q=a.progress[p];null!==q&&(o+='<div class="option option'+(e+1)+'" onclick="createGraph('+q[3]+"); changePercent("+q[3]+')"><div class="menu-icon" id="iconGraph'+(e+1)+'"></div><span class="menuInjuryName" onclick="change6(iconGraph'+(e+1)+"); change(iconGraph"+(e+1)+'); change(iconOverview); change2(iconOverviewTrans); change(overviewBox); change1(bodyBox); change(menuBox); change4(bottomBox)">'+q[1]+"</span></div>",e++)}n+=o+"</div>",m.innerHTML=n;for(var r=document.createElement("div"),s='<div class="outer-info-box"><div class="top-box"><button style="padding:0" id="menuButton" onclick="change1(menuBox); change5(bottomBox)")>&#9776</button></div>',t="",e=0,p=0;p<a.progress.length;p++){var q=a.progress[p];null!==q&&(c="#"+color(q[0])[0],t+='<div class="collapse-inner"><div class="input-label" id="input-label'+e+'">'+q[1]+'</div><div class="input-percent" id="input-percent'+e+'" style="color:'+c+'">',"#bbbbbb"===c?t+="N/A</div>":t+=q[0]+"%</div>",t+='<div class="graph-box"><img src="../../img/graph.png" class="graph-symbol" id="graph-symbol'+(e+1)+'" onclick="changePercent('+q[3]+"); createGraph("+q[3]+'); change(iconOverview); change(overviewBox); change1(bodyBox)"></div></div>',e++)}if(s+='<div class="bottom-box" id="bottomBox" style="overflow-y:auto;"><div class="overview-box" id="overviewBox">'+t,s+='<div class="exercise-set"><span id="exerciseTitle">Patient Exercises</span><br>',a.exercises.length>0)for(var p=0;p<a.exercises.length;p++)s+='<div id="exercise-overview'+a.exercises[p].id+'"><br><span><div id="exerciseText">'+a.exercises[p].name+'</div><div id="exerciseTextStreak">Streak</div><div id="exerciseTextPain">Pain</div></span><br>',s+='<div class="exercise-label" id="exercise-label">'+a.exercises[p].numSets+" sets, "+a.exercises[p].numRepsOrDuration+' Reps/Duration</div><div class="exercise-label" id="exercise-label">'+a.exercises[p].streak+"</div>",a.exercises[p].pain?s+='<div class="exercise-label" id="exercise-label">'+a.exercises[p].pain.painInput+"</div><br><br>":s+='<div class="exercise-label" id="exercise-label">N/A</div><br><br>',b||(s+='<a href="#" class="edit-exercise-btn" style="background-color:red" onclick="deleteExercise('+a.exercises[p].id+')">Delete</a><a href="/edit-exercise-set" class="edit-exercise-btn" onclick="focusExercise('+a.exercises[p].id+')">Edit</a>'),s+="</div><br>";else s+='<span id="exerciseText"> No Exercise Currently Assigned </span>';b||(s+='<br><a href="/exercise-set" class="new-exercise-btn">Add New Exercise</a><br><br>'),s+='</div><div class="notes"><span id="noteTitle">Notes</span><p id="notesSuccess"></p><textarea ',b&&(s+="readonly "),a.ptNotes?s+='class="note-input" type="notes" id="notes" name="notes" cols="25" rows="10">'+a.ptNotes+"</textarea>":s+='class="note-input" type="notes" id="notes" name="notes" cols="25" rows="10" placeholder="No notes entered..."></textarea>',b||(s+='<button onclick="submitNotes('+a.id+')">Update Notes</button>'),s+=' </div></div><div class="body-part-box" id="bodyBox"><div id="injuryTitle"></div><div class="percentage-box"><div class="percentage" style="color:'+c+'" id="singlePercent"></div><div class="recoveryText">recovered</div></div>',s+='<div id="loading1"><p>Loading</p><img src="../../img/loading.gif"></div><div class="graph-view" id="graph-container"><div class="svgh" id="graph"></div>',s+='<div class="legend"><div class="weekly-legend"><div class="weekly-goal-legend">Weekly Goal</div><div class="legend-circle"></div></div><div class="final-goal-legend">Final Goal<div class="dashes">- - - - -</div></div></div></div></div></div>',s+='<div class="transition-box"><div class="icon" id="iconOverviewTrans" style="background: rgb(46, 49, 146)"></div><div class="icon" id="iconGraphTrans"></div><div class="icon button-2"></div><div class="icon button-3"></div></div>',r.innerHTML=s;var u=document.getElementById("status").appendChild(k);u.appendChild(m),u.appendChild(r)}function renderExercisePage(){var a=JSON.parse(localStorage.patients)[0],b=document.createElement("div"),c="";if(a.exercises.length>0)for(var d=0;d<a.exercises.length;d++)c+='<div class="ex pt-box"><div class="ex-info"><div class="ex-info-name"><span>'+a.exercises[d].name+"</span></div>",c+='<div class="ex-info-details"><span>'+a.exercises[d].numSets+" Sets, "+a.exercises[d].numRepsOrDuration+' Reps/Duration</span></div></div><div class="ex-complete"><img class="complete-icon" src="../../img/checkIcon-13.png" onclick="painInput(this); localStorage.exId = '+a.exercises[d].id+'"></div></div>';else c+='<p class="headerGrey"> No Exercise Sets Currently Assigned </p>';b.innerHTML=c,document.getElementById("loading").style.display="none",document.getElementById("exercisepg").appendChild(b)}function changePercent(a){var b=JSON.parse(localStorage.focusPatient),c=b.progress[a];document.getElementById("singlePercent").style.color="#"+color(c[0])[0],document.getElementById("singlePercent").innerHTML=c[0]+"%",document.getElementById("injuryTitle").innerHTML=c[1]}function colorPercent(a,b){return"bbbbbb"===a?"<span>N/A</span>":'<font color = "#'+b+'"><span>'+a+"%</span></font>"}function submitNotes(a){fetch("/patients/"+a,{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"PUT",body:JSON.stringify({notes:document.getElementById("notes").value})}).then(function(a){if(!a.ok)throw new Error("There was an error sending this measure");document.getElementById("notesSuccess").innerHTML="Update Successful"}).catch(function(){document.getElementById("notesSuccess").style.color="#c1272d",document.getElementById("notesSuccess").innerHTML="Update Failed"})}function clear(){document.getElementById("patients").innerHTML=""}function getMeasurements(a){fetch("/romMetrics/"+a+"/romMetricMeasures/?token="+localStorage.token,{method:"GET"}).then(function(b){if(!b.ok)return submitError(b);b.json().then(function(b){for(var c=[],d=0,e=b.length-1;e>=0;e--)d<=3&&(c[d]={date:b[e].dayMeasured,measure:b[e].degreeValue},d++);c.reverse(),c[d]={date:b[b.length-1].dayOfNextGoal,goal:b[b.length-1].nextGoal},c[d+1]=b[b.length-1].endRangeGoal,localStorage["graphData"+a]=JSON.stringify(c)})}).catch(console.log("error"+a))}function getGraphData(){var a=JSON.parse(localStorage.focusPatient).id;fetch("/findInjuries/"+a+"/?token="+localStorage.token,{method:"GET"}).then(function(a){if(!a.ok)return submitError(a);a.json().then(function(a){for(var b=a[0].id||0,c=b;c<a.length+b;c++)!function(a){getMeasurements(a)}(c)})}).catch(submitError)}function updateProgress(a,b,c){fetch("/romMetrics/"+b+"/romMetricMeasures/?token="+localStorage.token,{method:"GET"}).then(function(d){if(!d.ok)return submitError(d);d.json().then(function(d){var e=JSON.parse(localStorage.patients),f=d[d.length-1];e[a].progress[b]=[Math.min((f.degreeValue/f.nextGoal*100).toFixed(1),100),c,f.degreeValue.toFixed(1),b,f.nextGoal],localStorage.patients=JSON.stringify(e)})}).catch(submitError)}function loadProgress(a){for(var b=JSON.parse(a),c=0;c<b.length;c++)!function(a){b[a].progress=[],b[a].exercises=[],fetch("/findInjuries/"+b[a].id+"/?token="+localStorage.token,{method:"GET"}).then(function(c){if(!c.ok)return submitError(c);c.json().then(function(c){loadExercises(b[a].id,a);for(var d=c[0].id||0,e=d;e<c.length+d;e++)!function(b){updateProgress(a,b,c[b-d].name)}(e)})}).catch(submitError)}(c);localStorage.patients=JSON.stringify(b)}function loadPatient(a){fetch("/romMetrics/"+a+"/romMetricMeasures/?token="+localStorage.token,{method:"GET"}).then(function(a){if(!a.ok)return submitError(a);a.json().then(function(a){var b=a[a.length-1]||0;localStorage.progress=JSON.stringify(b)})}).catch(submitError)}function loadExercises(a,b){fetch("/patients/"+a+"/exercises/?token="+localStorage.token,{method:"GET"}).then(function(a){if(!a.ok)return submitError(a);a.json().then(function(a){for(var c=JSON.parse(localStorage.patients),d=0;d<a.length;d++)c[b].exercises.push(a[d]),loadExercisesPain(a[d].id,b,d);localStorage.patients=JSON.stringify(c)})}).catch(submitError)}function loadExercisesPain(a,b,c){fetch("/exercises/"+a+"/exerciseCompletions/?token="+localStorage.token,{method:"GET"}).then(function(a){a.ok&&a.json().then(function(a){var d=JSON.parse(localStorage.patients);d[b].exercises[c].pain=a,localStorage.patients=JSON.stringify(d)})}).catch(function(a){404!=a.status&&submitError(a)})}function loadStart(){fetch("/pts/"+localStorage.id+"/patients?token="+localStorage.token).then(function(a){if(!a.ok)throw a;a.json().then(function(a){localStorage.isPatient=JSON.stringify(!1),localStorage.patients=JSON.stringify(a),localStorage.display=JSON.stringify(a),"[]"!=localStorage.patients?(clear(),loadProgress(localStorage.patients),loadPatients(localStorage.patients)):loadEmpty()})}).catch(submitError)}function loadPatientStart(){fetch("/patients/"+localStorage.id+"/?token="+localStorage.token).then(function(a){if(!a.ok)throw a;a.json().then(function(a){localStorage.isPatient=JSON.stringify(!0),localStorage.patients=JSON.stringify([a]),localStorage.display=JSON.stringify([a]),"[]"!=localStorage.patients?(clear(),loadProgress(localStorage.patients),loadPatients(localStorage.patients)):loadEmpty()})}).catch(submitError)}function loadExerciseStart(){renderExercisePage()}function load(){clear(),loadPatients(localStorage.display)}function search(a,b){for(var c=[],d=JSON.parse(b),e=0,f=d.length;e<f;e++)d[e].name.toUpperCase().includes(a.toUpperCase())&&c.push(d[e]);localStorage.display=JSON.stringify(c),console.log(c),c?loadEmpty():load()}function pSearch(){document.getElementById("loading").style.display="block",search(form.patientSearch.value,localStorage.patients)}function compareAlpha(a,b){return a.name<b.name?-1:a.name>b.name?1:0}function alphaDescending(a){return a.sort(compareAlphaRev)}function progAscending(){return patients.sort(function(a,b){a.progress,b.progress})}function sortAlpha(){document.getElementById("loading").style.display="block",localStorage.ctr1++;var a=JSON.parse(localStorage.patients);localStorage.ctr1%2!=0?localStorage.display=JSON.stringify(a.sort(compareAlpha)):localStorage.display=JSON.stringify(a.sort(compareAlpha).reverse()),load()}function findAverage(){for(var a=JSON.parse(localStorage.patients),b=0;b<a.length;b++){for(var c=0,d=0,e=0;e<a[b].progress.length;e++){var f=a[b].progress[e];null!=f&&(c+=+f[0],d++)}a[b].average=(c/d).toFixed(1)}localStorage.patients=JSON.stringify(a)}function sortProg(){document.getElementById("loading").style.display="block",localStorage.ctr2++,findAverage();var a=JSON.parse(localStorage.patients);localStorage.ctr2%2!=1?localStorage.display=JSON.stringify(a.sort(function(a,b){return a.average-b.average})):localStorage.display=JSON.stringify(a.sort(function(a,b){return b.average-a.average})),load()}function focusPatient(a){for(var b=JSON.parse(localStorage.patients),c=0;c<b.length;c++)b[c].id==a&&(localStorage.focusPatient=JSON.stringify(b[c]))}function focusExercise(a){for(var b=JSON.parse(localStorage.focusPatient).exercises,c=0;c<b[0].length;c++)b[0][c].id==a&&(localStorage.focusExercise=JSON.stringify(b[0][c]))}function deleteExercise(a){fetch("/exercises/"+a+"/?token="+localStorage.token,{method:"DELETE"}).then(function(a){if(!a.ok)return submitError(a)}).catch(submitError),document.getElementById("exercise-overview"+a).style.display="none"}function loadAddMeasure(){for(var a=JSON.parse(localStorage.focusPatient),b=document.createElement("div"),c="",d=0,e=0;e<a.progress.length;e++)null!==a.progress[e]&&(c+='<div class="inputs" id="box'+d+'" style="display:block"><div class="input-box input-header"><div class="input-name"><span>'+a.progress[e][1]+'</span><div class="input-label"></div></div><div class="progress-icon"></div></div><div class="input-box input-bottom"><div class="measure-container"><div class="m-old"><div class="num"><span>'+a.progress[e][2]+'</span></div><div class="m-label">PREVIOUS</div></div><div class="m-new"><div class="num"><input type="text" name="newMeasure" placeholder="NEW" id="middle-input"></div><div class="m-label">NEW</div></div><div class="m-new1"><div class="num"><input type="text" name="newMeasure" placeholder="GOAL"></div><div class="m-label">GOAL</div></div></div></div><div class="input-box action-box input-bottom submit" onclick="submitOne('+a.progress[e][3]+", "+d+", "+a.progress[e][2]+')">SUBMIT</div></div><br><br>',d++);b.innerHTML=c,document.getElementById("fields").appendChild(b)}function twoDigits(a){return 0<=a&&a<10?"0"+a.toString():-10<a&&a<0?"-0"+(-1*a).toString():a.toString()}function submitMeasure(a,b,c,d){form[2*b+1].value&&form[2*b].value?fetch("/romMetrics/"+a+"/?token="+localStorage.token,{method:"GET"}).then(function(c){if(!c.ok)return submitError(c);c.json().then(function(c){var e=new Date,f=new Date;f.setDate(f.getDate()+7);var c={dayMeasured:e.toMysqlFormat(),dayOfNextGoal:f.toMysqlFormat(),nextGoal:form[2*b+1].value,degreeValue:form[2*b].value,name:"name"+a,endRangeGoal:c.endRangeGoal};fetch("/romMetrics/"+a+"/romMetricMeasures",{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(c)}).then(function(a){if(!a.ok)throw new Error("There was an error sending this measure");d&&(window.location="/patients")}).catch(function(a){console.log(a)})})}).catch(function(){console.log("wrong")}):d&&(window.location="/patients")}function submitMeasures(){for(var a=JSON.parse(localStorage.focusPatient),b=0,c=0,d=0;d<a.progress.length;d++)null!==a.progress[d]&&c++;for(var e=0;e<a.progress.length;e++)null!==a.progress[e]&&(b==c-1?submitMeasure(a.progress[e][3],b,a.progress[e][2],!0):submitMeasure(a.progress[e][3],b,a.progress[e][2],!1),b++)}function submitOne(a,b,c){for(var d=0,e=document.getElementsByClassName("inputs"),f=0;f<e.length;f++)"none"!=e[f].style.display&&d++;document.getElementById("box"+b).style.display="none",d<=1?submitMeasure(a,b,c,!0):submitMeasure(a,b,c,!1)}function submitExercise(){var a={};a.name=form.exerciseName.value,a.numRepsOrDuration=parseInt(document.getElementById("reps-num").innerHTML,10),a.numSets=parseInt(document.getElementById("sets-num").innerHTML,10),form.notes.value&&(a.ptNotes=form.notes.value),fetch("/exerciseSets/"+localStorage.id+"/exercises",{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)}).then(function(a){a.ok||console.log(a)}).catch(function(a){console.log(a)})}function submitExerciseCompletion(a){var b={};b.painInput=Number(document.getElementById("painNum").value),fetch("/exercises/"+a+"/exerciseCompletions",{headers:{"x-access-token":localStorage.token,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(b)}).then(function(a){a.ok||console.log(a)}).catch(function(a){console.log(a)})}function loadEditExercise(){var a=JSON.parse(localStorage.focusExercise);setTimeout(function(){if(a.id){var b=document.createElement("div"),c="";c+='<input class="text-input exercise-name-input" type="text" name="motion-name" placeholder="ENTER EXERCISE NAME" onblur="checkExerciseName(this.value)" value="'+a.name+'">',c+='<div class="ex1"><div class="exercise-label">Number of Sets</div><input class="ex-input degrees" name="ex1" placeholder="____" onblur="checkExerciseNum(this.value)" maxlength="3" value="'+a.numSets+'"></div>',c+='<div class="ex2"><div class="exercise-label">Number of Reps/Duration</div><input class="text-input degrees2" name="ex2" placeholder="____" onblur="checkExerciseNum(this.value)" maxlength="3" value="'+a.numRepsOrDuration+'"></div><br>',c+='<div class="exercise-label" id="notes">Notes</div><textarea class="text-input notes" type="notes" id="notes" name="notes" cols="25" placeholder="Additional information about the exercise..." value="'+a.ptNotes+'"></textarea>',b.innerHTML=c,document.getElementById("patientExercise").appendChild(b)}else loadEditExercise()},50)}function createGraph(a){console.log(a),document.getElementById("graph").innerHTML="",document.getElementById("loading1").style.display="inline",document.getElementById("graph-container").style.display="none",setTimeout(function(){var b,c,d=JSON.parse(localStorage["graphData"+a]);window.innerWidth<600?(b=7.5*window.innerWidth/11,c=7*window.innerWidth/12):window.innerWidth>=600&&window.innerWidth<770?(b=8.5*window.innerWidth/13,c=4*window.innerWidth/7):window.innerWidth>=700&&window.innerWidth<1e3?(b=4*window.innerWidth/11,c=6*window.innerWidth/15):(b=2*window.innerWidth/5,c=2*window.innerWidth/5);var e=[],f=[],g=[];!function(){for(var a=0;a<d.length-2;a++){e.push(+d[a].measure);var b=+d[a].date.substring(0,4),c=+d[a].date.substring(5,7)-1,h=+d[a].date.substring(8,10)-1;f.push(new Date(b,c,h)),g.push([+d[a].measure,a+1])}}();var h=+d[d.length-1],i=d.length-2,j=+d[i].goal,k=+d[d.length-2].date.substring(0,4),l=+d[d.length-2].date.substring(5,7)-1,m=+d[d.length-2].date.substring(8,10)-1,n=new Date(k,l,m),o=[j,d.length-2],p=d3.min(e)-20,q=h+10,r=new Date(f[0].getTime()-6048e5),s=n,t=[r,s],u=d3.time.scale().domain([r,s]).range([0,b]),v=d3.scale.linear().domain([p,q]).range([c,50]),w=d3.svg.line().x(function(a,b){return u(f[b])}).y(function(a,b){return v(e[b])}),x=d3.svg.line().x(function(a,b){return u(t[b])}).y(function(){return v(h)}),y=d3.svg.line().x(function(a,b){return u(n[b])}).y(function(a,b){return v(j[b])})
;document.getElementById("loading1").style.display="none",document.getElementById("graph-container").style.display="inline";var z=d3.select("#graph").append("svg").attr("width","100%").attr("height","95%").append("svg:g").attr("transform","translate(20,-35)"),A=d3.svg.axis().scale(u).tickSize(0).tickFormat(d3.time.format("%-m/%-d")).tickPadding(4).ticks(d3.time.days,7).ticks(5),B=d3.svg.axis().scale(v).ticks(5).tickSize(0).orient("left");z.append("svg:g").attr("class","x axis").attr("transform","translate(20,"+c+")").call(A),z.append("svg:g").attr("transform","translate(20,0)").attr("class","y axis").call(B),z.append("svg:path").attr("d",w(e,f)).attr("transform","translate(20, 0)"),z.append("svg:path").attr("d",x(e,f)).attr("transform","translate(20,0)").attr("class","horizontalLine"),z.append("svg:path").attr("d",y(j,n)).attr("transform","translate(20, 0)"),z.selectAll(".point").data(g).enter().append("circle").attr("class","circles").attr("cx",function(a,b){return u(f[b])}).attr("cy",function(a,b){return v(e[b])}).attr("r",9).attr("transform","translate(18,0)"),z.selectAll(".point").data(o).enter().append("circle").attr("class","goal-point").attr("cx",function(a,b){return u(n)}).attr("cy",function(a,b){return v(j)}).attr("r",9).attr("transform","translate(18,0)")},1e3)}var form=document.forms[0],tokenForm=document.forms.namedItem("tokenForm"),hashTimeout;localStorage.ctr1=0,localStorage.ctr2=0,Date.prototype.toMysqlFormat=function(){return this.getUTCFullYear()+"-"+twoDigits(1+this.getUTCMonth())+"-"+twoDigits(this.getUTCDate())+" "+twoDigits(this.getUTCHours())+":"+twoDigits(this.getUTCMinutes())+":"+twoDigits(this.getUTCSeconds())};